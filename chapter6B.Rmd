---
title: "Chapter 6B"
author: "Blair and Bill"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
--- 
#The other data set!

 This is the code to the data:
``` {r,echo=TRUE,results='hide',message=FALSE,warning=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(lme4)

BPRS <- read.table("https://raw.githubusercontent.com/KimmoVehkalahti/MABS/master/Examples/data/BPRS.txt", sep  =" ", header = T)
```
  
**1.** Implementation of Chapter 9 using the BPRS data!

I first need to prep the data before i run the tests. I had issues using the wrangled data so I will wrangle it here first.
```{r}
str(BPRS)
```

*40 observations, 11 variables, appears to be repeated measurments each week*

```{r}
summary (BPRS)
```

*treatment= dichotimous*
*subject= numbered 1 through 20*
*Week #= apears to be score 1-100, and each week the median decreases*


## Factor treatment & subject
```{r}
BPRS$treatment <- factor(BPRS$treatment)
BPRS$subject <- factor(BPRS$subject)
```

*both treatment and subject changed to factors when I glimpsed the data.*

## Covert the datasets to long form
```{r}
BPRSL <-  BPRS %>% gather(key = weeks, value = bprs, -treatment, -subject)
```

*It worked!*

## Extract the week number
```{r}
BPRSL <-  BPRSL %>% mutate(week = as.integer(substr(weeks,5,5)))
```

*BPRSL contains 360 observations and 5 variables; long form = When you think 'long', think vertical*

#3 Check the dimensions of the data
```{r}
dim(BPRSL)
```

#3 Plot the BPRSL data
```{r}
ggplot(BPRSL, aes(x = week, y = bprs, linetype = subject)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ treatment, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(BPRSL$bprs), max(BPRSL$bprs)))
```

## create a regression model BPRS_reg
```{r}
BPRS_reg <- lm(bprs ~ week + treatment, data = BPRSL)
```

## print out a summary of the model
```{r}
summary(BPRS_reg)
```

## Create a random intercept model
```{r}
BRPS_ref <- lmer(bprs ~ week + treatment + (1 | subject), data = BPRSL, REML = FALSE)

## Print the summary of the model
summary(BRPS_ref)
```


